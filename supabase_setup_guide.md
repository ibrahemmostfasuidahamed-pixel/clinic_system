# دليل إعداد Supabase لعيادة الأسنان

## 1. إنشاء مشروع Supabase
1. انتقل إلى https://app.supabase.com و سجّل حسابًا إذا لم يكن لديك حساب.
2. اضغط **New Project**.
3. اختر اسمًا للمشروع (مثال: `clinic-dental`).
4. حدد المنطقة القريبة من مستخدميك.
5. اضغط **Create new project**.

## 2. إعداد قاعدة البيانات
- بعد إنشاء المشروع، افتح **SQL editor** في لوحة التحكم.
- الصق محتوى ملف `supabase_schema.sql` الموجود في مجلد المشروع ثم اضغط **Run**.
- سيُنشئ الجداول: `patients`, `doctors`, `services`, `appointments`, `ai_logs`.

## 3. الحصول على مفاتيح API
1. في القائمة الجانبية اختر **Settings → API**.
2. انسخ القيم التالية:
   - **URL** (مثال: `https://YOUR_PROJECT.supabase.co`).
   - **anon public** (المفتاح العام).
3. احفظهما في ملف **.env** أو استبدل القيم في `app.js`:
   ```js
   const SUPABASE_URL = "https://YOUR_PROJECT.supabase.co";
   const SUPABASE_ANON_KEY = "YOUR_ANON_KEY";
   ```

## 4. تمكين Row Level Security (اختياري)
- إذا أردت التحكم في صلاحيات الوصول، افتح **Table Editor** لكل جدول ثم فعل **RLS**.
- أنشئ سياسات (policies) حسب الحاجة (مثال: السماح للمستخدمين المسجلين فقط بالقراءة والكتابة).

## 5. ربط n8n بـ Supabase
1. في لوحة تحكم n8n، أضف **Credential** من نوع **Supabase**.
2. أدخل نفس `SUPABASE_URL` و `SUPABASE_ANON_KEY`.
3. في ملف `n8n_workflow.json` استبدل `YOUR_N8N_DOMAIN` بعنوان ن8ن الخاص بك.
4. استورد الـ workflow عبر **Import** في n8n ثم فعلها.

## 6. اختبار الاتصال
- شغّل `app.js` في المتصفح.
- يجب أن تظهر رسائل “تم إضافة المريض بنجاح” أو “خطأ …” حسب الحالة.
- يمكنك تجربة استدعاء `triggerAIWebhook` عبر زر أو استدعاء يدوي من المتصفح.

## 7. ملاحظات إضافية
- تأكد من أن قاعدة البيانات تسمح بالوصول من النطاقات (CORS) التي تستضيف فيها الواجهة.
- إذا أردت تفعيل المصادقة (Auth) في Supabase، يمكنك إضافة **Auth** من القائمة ثم تعديل `app.js` لاستخدام `supabase.auth`.
- احرص على عدم نشر المفاتيح العامة في مستودعات عامة.

---
*تم إعداد هذا الدليل لتسهيل إعداد بيئة Supabase وربطها بواجهة الويب و n8n.*
